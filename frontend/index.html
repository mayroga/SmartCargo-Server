<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SMARTCARGO-AIPA | Avianca Cargo</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
body { font-family: Arial; background:#f4f6f9; padding:20px; }
.container { max-width:900px; margin:auto; background:white; padding:25px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
.section { margin-bottom:20px; border:1px solid #ddd; border-radius:6px; }
.header { background:#003366; color:white; padding:10px; cursor:pointer; font-weight:bold;}
.content { display:none; padding:15px;}
input, select { width:100%; padding:8px; margin-top:6px; margin-bottom:10px;}
button { padding:12px; border:none; border-radius:6px; cursor:pointer; margin-top:10px;}
.primary { background:#e10600; color:white; width:100%;}
.secondary { background:#555; color:white; width:100%;}
#summary { margin-top:20px; padding:15px; border-radius:6px; display:none;}
</style>
</head>
<body>

<div class="container">
<h1>SMARTCARGO-AIPA</h1>

<form id="cargoForm">

<div class="section">
<div class="header" onclick="toggle(this)">Fase 1</div>
<div class="content">
<input type="text" id="clientId" placeholder="Client ID / SCAC">
<select id="highValue">
<option value="no">Value â‰¤ 2500</option>
<option value="yes">Value > 2500</option>
</select>
<input type="text" id="itnNumber" placeholder="ITN">
<select id="shipmentType">
<option value="direct">Direct</option>
<option value="consolidated">Consolidated</option>
</select>
</div>
</div>

<div class="section">
<div class="header" onclick="toggle(this)">Fase 2</div>
<div class="content">
<input type="number" id="pieceHeight" placeholder="Height (inches)">
<input type="number" id="pieceWeight" placeholder="Max Weight (kg)">
<select id="nimf15">
<option value="yes">NIMF-15 OK</option>
<option value="no">No NIMF-15</option>
</select>
<select id="palletType">
<option value="PMC">PMC</option>
<option value="PAG">PAG</option>
<option value="PAJ">PAJ</option>
</select>
</div>
</div>

<!-- Hidden operational defaults -->
<input type="hidden" id="dangerousGoods" value="no">
<input type="hidden" id="origin" value="no">
<input type="hidden" id="awbCopies" value="yes">
<input type="hidden" id="zipCode" value="33142">
<input type="hidden" id="arrivalTime" value="12:00">
<input type="hidden" id="straps" value="yes">
<input type="hidden" id="awbOnBoxes" value="yes">
<input type="hidden" id="damagedBoxes" value="no">
<input type="hidden" id="shrinkWrap" value="yes">
<input type="hidden" id="oldLabels" value="no">
<input type="hidden" id="cleanCargo" value="yes">
<input type="hidden" id="fragileLabels" value="yes">
<input type="hidden" id="piecesMatch" value="yes">
<input type="hidden" id="tanks" value="no">
<input type="hidden" id="overhang" value="0">

<button type="button" class="primary" onclick="evaluar()">EVALUAR</button>
<button type="button" class="secondary" onclick="resetForm()">BORRAR</button>

</form>

<div id="summary"></div>

</div>

<script>
function toggle(el){
  el.nextElementSibling.style.display =
  el.nextElementSibling.style.display === "block" ? "none" : "block";
}

async function evaluar(){
  const data = {};
  document.querySelectorAll("input, select").forEach(el=>{
    data[el.id] = el.type === "number" ? parseFloat(el.value) || 0 : el.value;
  });

  const res = await axios.post("/evaluar", data);

  const summary = document.getElementById("summary");
  summary.style.display = "block";
  summary.style.background = res.data.status === "APROBADO" ? "#d4edda" : "#f8d7da";

  let html = `<h3>Veredicto: ${res.data.status}</h3><ul>`;
  res.data.detalle.forEach(d => html += `<li>${d}</li>`);
  html += "</ul>";

  const pdf = await axios.post("/generar_pdf", data);
  html += `<a href="${pdf.data.url}" target="_blank">ðŸ“„ Descargar PDF</a>`;

  summary.innerHTML = html;
}

function resetForm(){
  document.getElementById("cargoForm").reset();
  document.getElementById("summary").style.display="none";
}
</script>

</body>
</html>
