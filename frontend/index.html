<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SMARTCARGO-AIPA</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
body{background:#111;color:white;font-family:Arial;padding:30px}
input,button{margin:5px;padding:8px}
button{cursor:pointer}
.alert{color:red;font-weight:bold}
.success{color:lime}
</style>
</head>
<body>

<h2>SMARTCARGO â€“ Advanced Pre-Counter</h2>
<button onclick="toggleLang()">ðŸŒŽ ES / EN</button>

<div id="loginSection">
<h3>Login</h3>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div id="appSection" style="display:none;">
<h3>Cargo Input</h3>

<input id="origin" placeholder="Origin">
<input id="destination" placeholder="Destination">
<input id="weight" type="number" placeholder="Weight (kg)">
<input id="length" type="number" placeholder="Length (cm)">
<input id="width" type="number" placeholder="Width (cm)">
<input id="height" type="number" placeholder="Height (cm)">
<input id="pieces" type="number" placeholder="Pieces">

<label><input type="checkbox" id="temp"> Temperature Required</label><br>
<label><input type="checkbox" id="dg"> Dangerous Goods</label><br>
<label><input type="checkbox" id="packaging"> Packaging OK</label><br>
<label><input type="checkbox" id="docs"> Documents Complete</label><br>

<input id="dryice" type="number" placeholder="Dry Ice (kg)">

<br>
<button onclick="analyze()">RUN ADVANCED FILTER</button>

<h3>Result</h3>
<div id="result"></div>
</div>

<script>
let token = null
let lang = "EN"

function toggleLang(){
    lang = lang === "EN" ? "ES" : "EN"
    alert("Language changed to " + lang)
}

async function login(){
    try{
        const res = await axios.post("/login",{
            username:document.getElementById("user").value,
            password:document.getElementById("pass").value
        })
        token = res.data.access_token
        document.getElementById("loginSection").style.display="none"
        document.getElementById("appSection").style.display="block"
    }catch{
        alert("Login failed")
    }
}

async function analyze(){
    try{
        const res = await axios.post("/analyze",{
            origin:origin.value,
            destination:destination.value,
            weight_kg:parseFloat(weight.value),
            length_cm:parseFloat(length.value),
            width_cm:parseFloat(width.value),
            height_cm:parseFloat(height.value),
            pieces:parseInt(pieces.value),
            temperature_required:temp.checked,
            dangerous_goods:dg.checked,
            packaging_ok:packaging.checked,
            documents_complete:docs.checked,
            dry_ice_kg:parseFloat(dryice.value||0)
        },{
            headers:{Authorization:`Bearer ${token}`}
        })

        let r = res.data
        let color = r.status==="CLEARED"?"success":"alert"

        result.innerHTML = `
        <div class="${color}">
        Status: ${r.status}<br>
        Volumetric Weight: ${r.volumetric_weight} kg<br>
        Chargeable Weight: ${r.chargeable_weight} kg<br>
        PSI: ${r.psi}<br>
        ${r.critical_alert ? "âš  "+r.critical_alert+"<br>" : ""}
        </div>
        <hr>
        <b>AI Observation:</b><br>
        ${r.ai_observation}
        `
    }catch(e){
        alert("Error analyzing cargo")
    }
}
</script>

</body>
</html>
