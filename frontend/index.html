<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SMARTCARGO – SISTEMA INFALIBLE</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<style>
body{ font-family: Arial,sans-serif; margin:0; background:#f4f6f9; }
header{ background:#e20613; color:white; padding:20px; text-align:center; font-size:1.8em; font-weight:bold; }
section{ background:white; margin:20px; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
h2{ margin-top:0; border-bottom:2px solid #e20613; padding-bottom:5px; }
input,select{ width:100%; padding:10px; margin:6px 0 15px 0; border-radius:5px; border:1px solid #ccc; }
button{ background:#e20613; color:white; border:none; padding:12px 20px; border-radius:5px; cursor:pointer; font-size:1.1em; }
button:hover{ background:#b10410; }
.alert{ padding:10px; margin:8px 0; border-radius:5px; }
.critical{ background:#f8d7da; color:#721c24; }
.warning{ background:#fff3cd; color:#856404; }
.success{ background:#d4edda; color:#155724; }
.info{ background:#d1ecf1; color:#0c5460; }
#resultado{ margin:20px; }
.explicacionIA{ background:#eef2ff; padding:10px; margin-top:5px; border-left:4px solid #4f46e5; font-size:0.95em; }
.smallinfo{ font-size:0.9em; background:#f1f1f1; padding:8px; border-radius:5px; margin-bottom:10px; }
.status{ font-size:1.4em; font-weight:bold; margin:10px 0; }
</style>
</head>
<body>

<header>SMARTCARGO – SISTEMA INFALIBLE</header>

<form id="cargoForm" enctype="multipart/form-data">

<section>
<h2>Fase 1: Identificación y Seguridad</h2>
<input type="text" name="clientId" placeholder="ID Cliente / Known Shipper">
<select name="highValue">
<option value="">¿Valor mayor a $2,500 USD?</option>
<option value="yes">Sí</option>
<option value="no">No</option>
</select>
<input type="text" name="itnNumber" placeholder="Número ITN (si aplica)">
<input type="text" name="awbMaster" placeholder="AWB Master">
<input type="text" name="originAirport" placeholder="Aeropuerto origen">
<input type="text" name="destinationAirport" placeholder="Aeropuerto destino">
<input type="date" name="departureDate">
</section>

<section>
<h2>Fase 2: Anatomía de la Carga</h2>
<div class="smallinfo">
Altura permitida pasajeros: 63 in.<br>
Altura máxima carguero: 96 in.<br>
Pieza >150kg requiere SHORING.<br>
Full pallet estándar: 48x40 in – máx 1000kg.
</div>
<input type="number" step="0.1" name="pieceHeight" placeholder="Altura pieza (in)">
<input type="number" step="0.1" name="pieceWeight" placeholder="Peso pieza más pesada (kg)">
<input type="number" name="numPieces" placeholder="Número total de piezas">
<input type="number" step="0.1" name="totalWeight" placeholder="Peso total (kg)">
<select name="needsShoring">
<option value="">¿Necesita Shoring?</option>
<option value="si">Sí</option>
<option value="no">No</option>
</select>
<select name="nimf15">
<option value="">¿Pallet certificado NIMF-15?</option>
<option value="si">Sí</option>
<option value="no">No</option>
</select>
<select name="overhang">
<option value="">¿Existe Overhang?</option>
<option value="yes">Sí</option>
<option value="no">No</option>
</select>
<input type="file" name="fotoCarga">
</section>

<section>
<h2>Fase 3: Contenidos Críticos</h2>
<select name="cargoType">
<option value="">Tipo de carga</option>
<option value="NORMAL">Normal</option>
<option value="DGR">Mercancía Peligrosa (DGR)</option>
<option value="PER">Perishable</option>
<option value="BIO">Biológica</option>
</select>
<select name="dgrDocs">
<option value="">¿Documentos DGR completos?</option>
<option value="si">Sí</option>
<option value="no">No</option>
</select>
<select name="fitoDocs">
<option value="">¿Certificados FDA/Fitosanitarios?</option>
<option value="si">Sí</option>
<option value="no">No</option>
</select>
<input type="file" name="docsCertificados">
</section>

<section>
<h2>Fase Final: Logística y Embalaje</h2>
<input type="text" name="arrivalTime" placeholder="Hora llegada counter">
<select name="packaging">
<option value="">Tipo de embalaje</option>
<option value="straps">Straps</option>
<option value="shrink">Shrink Wrap</option>
</select>
<input type="text" name="zipCode" placeholder="Código Postal">
</section>

<section>
<button type="button" onclick="evaluar()">Evaluar Carga</button>
<button type="button" onclick="generarPDF()">Generar PDF</button>
</section>

</form>

<div id="resultado"></div>

<script>
async function evaluar(){
    const form = document.getElementById("cargoForm");
    const data = new FormData(form);
    const resultadoDiv = document.getElementById("resultado");
    resultadoDiv.innerHTML="Evaluando...";

    try{
        const response = await axios.post("https://smartcargo-server.onrender.com/evaluar", data);
        let html = `<div class="status">${response.data.status}</div>`;

        response.data.explicaciones.forEach(item=>{
            let clase="info";
            if(item.error.includes("❌")) clase="critical";
            else if(item.error.includes("⚠️")) clase="warning";
            else if(item.error.includes("✅")) clase="success";

            html += `<div class="alert ${clase}">${item.error}</div>`;
            html += `<div class="explicacionIA">${item.explicacion}</div>`;
        });

        resultadoDiv.innerHTML = html;

    }catch(error){
        resultadoDiv.innerHTML = `<div class="alert critical">Error conectando con servidor</div>`;
    }
}

async function generarPDF(){
    const form = document.getElementById("cargoForm");
    const data = new FormData(form);
    const resultadoDiv = document.getElementById("resultado");
    resultadoDiv.innerHTML="Generando PDF...";

    try{
        const response = await axios.post("https://smartcargo-server.onrender.com/generar_pdf", data);
        resultadoDiv.innerHTML = `<a href="https://smartcargo-server.onrender.com${response.data.url}" target="_blank">Abrir Reporte PDF</a>`;
    }catch(error){
        resultadoDiv.innerHTML = `<div class="alert critical">Error generando PDF</div>`;
    }
}
</script>

</body>
</html>
