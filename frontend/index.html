<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>SMARTCARGO-AIPA | Prechequeo Avianca</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
body { font-family: Arial; background:#f5f5f5; color:#000; margin:0; padding:0;}
.container { max-width: 1000px; margin:auto; padding:20px;}
h1 { text-align:center;}
.fase { background:#fff; padding:15px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;}
button { padding:10px 15px; margin-top:10px;}
.alerta { color:red; font-weight:bold;}
.sugerencia { color:green; font-weight:bold; }
.detalle { margin-left:15px; font-size:14px; color:#555;}
.collapse { cursor:pointer; padding:10px; background:#eee; border-radius:5px; margin-bottom:5px; }
.content { display:none; padding:10px; border:1px solid #ddd; border-radius:5px; margin-bottom:10px; background:#f9f9f9;}
</style>
</head>
<body>
<div class="container">
<h1>SMARTCARGO-AIPA | Prechequeo Avianca Cargo</h1>

<form id="cargoForm">
<!-- Todas las fases 1-8 (idénticas al ejemplo anterior, omitted por brevedad) -->
<!-- Copiar campos exactos del HTML anterior -->
</form>

<button type="button" onclick="evaluar()">Evaluar Carga</button>
<button type="button" onclick="generarPDF()">Generar PDF</button>

<div id="resultado" class="alerta"></div>
<div id="sugerencias" class="sugerencia"></div>

<script>
document.querySelectorAll(".collapse").forEach(function(el){
    el.onclick = function(){ 
        this.nextElementSibling.style.display = this.nextElementSibling.style.display === "block" ? "none" : "block";
    }
});

async function evaluar(){
    const form = document.getElementById("cargoForm");
    const data = Object.fromEntries(new FormData(form));
    const response = await axios.post("/evaluar", data);
    let res = response.data;
    let html = `<strong>Veredicto: ${res.status}</strong><br>`;
    res.detalle.forEach(d => { html += `<div class="detalle">- ${d}</div>`; });
    document.getElementById("resultado").innerHTML = html;

    let sugerencias = "";
    res.sugerencias.forEach(s => { sugerencias += `- ${s}<br>`; });
    document.getElementById("sugerencias").innerHTML = sugerencias;
}

// Evaluación instantánea mientras escribes (IA en tiempo real)
document.querySelectorAll("#cargoForm input").forEach(el=>{
    el.addEventListener("input", async ()=>{
        const form = document.getElementById("cargoForm");
        const data = Object.fromEntries(new FormData(form));
        const response = await axios.post("/evaluar", data);
        let res = response.data;
        let html = `<strong>Veredicto: ${res.status}</strong><br>`;
        res.detalle.forEach(d => { html += `<div class="detalle">- ${d}</div>`; });
        document.getElementById("resultado").innerHTML = html;

        let sugerencias = "";
        res.sugerencias.forEach(s => { sugerencias += `- ${s}<br>`; });
        document.getElementById("sugerencias").innerHTML = sugerencias;
    });
});

async function generarPDF(){
    const form = document.getElementById("cargoForm");
    const data = Object.fromEntries(new FormData(form));
    const response = await axios.post("/generar_pdf", data);
    const res = response.data;
    alert(`PDF generado: ${res.filename}\nVeredicto: ${res.veredicto}`);
}
</script>

</div>
</body>
</html>
